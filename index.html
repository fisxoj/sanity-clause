<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" href="default.css" type="text/css" />
<title>sanity-clause</title>
<meta name="Author" content="Matt Novenstern" />
</head>
<body>
<div id="sanity-clause" class="document"><h1 class="title">sanity-clause</h1>
<table class="docinfo" frame="void" rules="none"><col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author</th><td>Matt Novenstern</td></tr><tr><th class="docinfo-name">Version</th><td>0.7.3</td></tr><tr class="field"><th colspan="1" class="docinfo-name">license:</th><td class="field-body">LGPLv3</td>
</tr>
<tr class="field"><th colspan="1" class="docinfo-name">homepage:</th><td class="field-body"><a class="reference" href="https://fisxoj.github.io/sanity-clause/"><span>https://fisxoj.github.io/sanity-clause/</span></a></td>
</tr>
</tbody>
</table>
<div class="image image-reference"><a class="reference" href="https://travis-ci.org/fisxoj/sanity-clause"><span><img src="https://travis-ci.org/fisxoj/sanity-clause.svg?branch=master" alt="Travis CI status badge" /></span></a></div>
<div class="image image-reference"><a class="reference" href="https://coveralls.io/github/fisxoj/sanity-clause?branch=master"><span><img src="https://coveralls.io/repos/github/fisxoj/sanity-clause/badge.svg?branch=master" alt="Coveralls status badge" /></span></a></div>
<div class="image image-reference"><a class="reference" href="CODE_OF_CONDUCT.md"><span><img src="https://img.shields.io/badge/Contributor%20Covenant-v1.4%20adopted-ff69b4.svg" alt="Contributor Covenant" /></span></a></div>
<table class="field-list" frame="void" rules="none"><col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th colspan="1" class="field-name">Source:</th><td class="field-body"><a class="reference" href="https://github.com/fisxoj/sanity-clause"><span>https://github.com/fisxoj/sanity-clause</span></a></td>
</tr>
<tr class="field"><th colspan="1" class="field-name">Docs:</th><td class="field-body"><a class="reference" href="https://fisxoj.github.io/sanity-clause/"><span>https://fisxoj.github.io/sanity-clause/</span></a></td>
</tr>
</tbody>
</table>
<!--  -->
<blockquote> <p>You can't fool me. There ain't no santy clause!</p>
<p class="attribution">&mdash; Chico Marx  </p>
</blockquote> <p>Sanity clause is a data validation/contract library.  You might use it for configuration data, validating an api response, or documents from a datastore.  In a dynamically typed language, it helps you define clearly defined areas of doubt and uncertainty.  We should love our users, but we should never blindly trust their inputs.</p>
<p>To make use of it, you define schemas, which can be property lists with keys and instances of <a class="reference ref-class" href="sanity-clause.field.html#class-field"><span class="ref-class">sanity-clause.field:field</span></a> subclasses as values (eg. <a class="reference ref-class" href="sanity-clause.field.html#class-integer-field"><span class="ref-class">sanity-clause.field:integer-field</span></a>, <a class="reference ref-class" href="sanity-clause.field.html#class-string-field"><span class="ref-class">sanity-clause.field:string-field</span></a>, &amp;c.) or using the class-based interface via <a class="reference ref-class" href="sanity-clause.schema.html#class-validated-metaclass"><span class="ref-class">sanity-clause.schema:validated-metaclass</span></a>.  For example:</p>
<pre class="literal-block">
(list :name (make-field :string) :age (make-field :integer))
</pre><p>You can load these sorts of schemas from a file by writing them as sexps with keywords, like this:</p>
<pre class="literal-block">
schema.sexp

(:key (:string :validator (:not-empty) :default "potato")
 :key2 (:integer :validator ((:int :min 0)) :default 2))
</pre><p>and then loading them using <a class="reference ref-function" href="sanity-clause.loadable-schema.html#function-load-schema"><span class="ref-function">sanity-clause.loadable-schema:load-schema</span></a> to load them.</p>
<p>To use class-based schemas using <a class="reference ref-class" href="sanity-clause.schema.html#class-validated-metaclass"><span class="ref-class">sanity-clause.schema:validated-metaclass</span></a> you can do things like:</p>
<pre class="literal-block">
(defclass person ()
     ((favorite-dog :type symbol
                    :field-type :member
                    :members (:wedge :walter)
                    :required t)
      (age :type (integer 0)
           :required t)
      (potato :type string
              :required t))
     (:metaclass sanity-clause:validated-metaclass))
</pre><p>which will validate their initargs when you instantiate them (<strong><span>BUT NOT WHEN YOU SET SLOTS</span></strong>).  Hopefully, that will be added eventually, perhaps as an optional feature.</p>
<div id="example" class="section"><h2><a name="example">Example</a></h2>
<p><tt class="docutils literal">
<span class="pre">v2-info.json</span></tt>:</p>
<pre class="literal-block">
{
  "title": "Swagger Sample App",
  "description": "This is a sample server Petstore server.",
  "termsOfService": "http://swagger.io/terms/",
  "contact": {
    "name": "API Support",
    "url": "http://www.swagger.io/support",
    "email": "support@swagger.io"
  },
  "license": {
    "name": "Apache 2.0",
    "url": "http://www.apache.org/licenses/LICENSE-2.0.html"
  },
  "version": "1.0.1"
}

</pre><p><tt class="docutils literal">
<span class="pre">example.lisp</span></tt>:</p>
<pre class="literal-block">
;; load required libraries
(ql:quickload '(jonathan sanity-clause))

(defclass contact-object ()
  ((name :type string
         :data-key "name"
         :documentation "The identifying name of the contact person/organization.")
   (url :type string
        :data-key "url"
        :field-type :uri
        :documentation "The URL pointing to the contact information. MUST be in the format of a URL.")
   (email :type string
          :data-key "email"
          :field-type :email
          :documentation "The email address of the contact person/organization. MUST be in the format of an email address."))
  (:metaclass sanity-clause:validated-metaclass))


(defclass license-object ()
  ((name :type string
         :data-key "name"
         :documentation "The license name used for the API.")
   (url :type string
        :data-key "url"
        :field-type :uri
        :documentation "A URL to the license used for the API. MUST be in the format of a URL."))
  (:metaclass sanity-clause:validated-metaclass))


(defclass info-object ()
  ((title :type string
          :data-key "title"
          :required t
          :documentation "The title of the application.")
   (description :type string
                :data-key "description"
                :documentation "A short description of the application. GFM syntax can be used for rich text representation.")
   (terms-of-service :type string
                     :data-key "termsOfService"
                     :documentation "The Terms of Service for the API.")
   (contact :type contact-object
            :field-type :nested
            :data-key "contact"
            :element-type contact-object
            :documentation "The contact information for the exposed API.")
   (license :type license-object
            :field-type :nested
            :element-type license-object
            :data-key "license"
            :documentation "The license information for the exposed API.")
   (version :type string
            :documentation "Provides the version of the application API (not to be confused with the specification version)."
            :data-key "version"
            :required t))
  (:metaclass sanity-clause:validated-metaclass))

;;; Deserialize the json from the file into instances of these classes

(let ((v2-info (alexandria:read-file-into-string (merge-pathnames "v2-info.json" *load-truename*))))
  (sanity-clause:load 'info-object (jojo:parse v2-info :as :alist)))

;; =&gt; #&lt;INFO-OBJECT {10045F9C93}&gt;

(slot-value * 'license)

;; =&gt; #&lt;LICENSE-OBJECT {1006600BE3}&gt;

(slot-value * 'name)

;; =&gt; "Apache 2.0"


</pre><div id="packages" class="section"><h3><a name="packages">Packages</a></h3>
<ul>
<li><p class="first last"><a class="reference" href="sanity-clause.util.html"><span>sanity-clause.util</span></a></p>
</li>
<li><p class="first last"><a class="reference" href="sanity-clause.validator.html"><span>sanity-clause.validator</span></a></p>
</li>
<li><p class="first last"><a class="reference" href="sanity-clause.protocol.html"><span>sanity-clause.protocol</span></a></p>
</li>
<li><p class="first last"><a class="reference" href="sanity-clause.field.html"><span>sanity-clause.field</span></a></p>
</li>
</ul>
</div>
</div>
<hr class ="docutils footer" /><div class="footer">Generated on : Sat, 04 Apr 2020 03:42:41 .
</div>
</div>
</body>
</html>